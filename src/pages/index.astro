---
import {getCollection, getEntry} from "astro:content";
import {isToday, isYesterday} from "date-fns";
import Article from "../components/Article.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import {pathBuilder} from "../utils";

const articles = await getCollection("articles");
const categories = await getCollection("categories");
const tags = await getCollection("tags");

const [firstArticle, ...otherArticles] = articles.sort((a, b) => {
    return b.data.publishDate.getTime() - a.data.publishDate.getTime()
})
---

<BaseLayout title="Главная">
    <Header/>

    <main class="container">
        <section class="latest-article-section">
            <Article
                id={firstArticle.id}
                isHero={true}
                article={firstArticle.data}
            />
        </section>

        <div class="content">
            <section class="section section--articles">
                <h2 class="section__title">Статьи</h2>
                {otherArticles.map((article) => <Article id={article.id} article={article.data} />)}
            </section>

            <aside class="sidebar">
                <section class="section">
                    <h2 class="section__title">Категории</h2>
                    <ul class="categories">
                        {categories.map((category) => {
                            return <li><a href={pathBuilder.singleTag(category.data.slug)}>{category.data.name}</a></li>
                        })}
                    </ul>
                </section>
                <section class="section">
                    <h2 class="section__title">Метки</h2>
                    <ul class="categories">
                        {tags.map((tag) => {
                            return <li><a href={pathBuilder.singleTag(tag.data.slug)}>{tag.data.name}</a></li>
                        })}
                    </ul>
                </section>
            </aside>
        </div>
    </main>

    <Footer />
</BaseLayout>

<style>
    .latest-article-section {
        margin-block: 7rem;
    }

    .section {
        margin-block-end: 2rem;
    }

    .section--articles {
        display: flex;
        flex-direction: column;
        gap: 2.5rem;
    }

    .section__title {
        font-size: 0.8rem;
        font-weight: 500;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        opacity: 0.5;
        margin: 0;
        margin-block-end: 1rem;
        display: flex;
        align-items: center;
        gap: 5%;
    }

    .section__title::after {
        content: "";
        display: block;
        flex-grow: 1;
        background-color: black;
        height: 1px;
        opacity: 0.3;
    }

    .content {
        display: grid;
        gap: 4rem;
        grid-template-columns: 9fr 3fr;
    }

    .categories {
        margin: 0;
        padding: 0;
        list-style: none;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
</style>
